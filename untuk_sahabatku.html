<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesan Spesial untuk Sahabatku</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Font Inter */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to right, #84fab0 0%, #8fd3f4 100%); /* Latar belakang gradien yang ceria dan segar */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="bg-white p-8 md:p-12 rounded-3xl shadow-xl max-w-md w-full text-center transform hover:scale-105 transition-transform duration-300">
        <!-- Judul pesan persahabatan -->
        <h1 class="text-4xl md:text-5xl font-extrabold text-green-600 mb-6 drop-shadow-lg">
            Untuk Sahabat Terbaikku ü§ù
        </h1>
        <!-- Pesan persahabatan awal -->
        <p id="friendshipMessage" class="text-lg md:text-xl text-gray-800 leading-relaxed mb-8">
            Sahabatku, terima kasih sudah selalu ada, dalam suka maupun duka. Kamu adalah salah satu anugerah terindah dalam hidupku. Senang rasanya bisa berbagi tawa dan cerita denganmu. Semoga persahabatan kita langgeng selamanya!
        </p>
        <!-- Loading indicator for message generation -->
        <div id="loadingIndicator" class="hidden text-green-600 font-semibold mb-4">
            Menulis pesan persahabatan... ‚úçÔ∏è
        </div>
        <!-- Button to generate new message using Gemini API -->
        <button id="generateMessageBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300">
            ‚ú® Hasilkan Pesan Baru ‚ú®
        </button>
        <!-- Teks penutup atau nama pengirim -->
        <p class="text-md md:text-lg font-semibold text-green-500 mt-8">
            Dari,
            <br>
            AlfonsoLexy
        </p>
    </div>

    <script>
        // Mendapatkan referensi elemen DOM
        const friendshipMessageElement = document.getElementById('friendshipMessage');
        const generateMessageBtn = document.getElementById('generateMessageBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Menambahkan event listener untuk tombol "Hasilkan Pesan Baru"
        generateMessageBtn.addEventListener('click', async () => {
            // Mengosongkan teks pesan saat ini
            friendshipMessageElement.textContent = '';
            // Menampilkan indikator loading
            loadingIndicator.classList.remove('hidden');
            // Menonaktifkan tombol untuk mencegah klik ganda selama proses
            generateMessageBtn.disabled = true;

            // Mendefinisikan prompt untuk Gemini API agar menghasilkan pesan persahabatan
            const prompt = "Tulis pesan persahabatan yang tulus, mendukung, dan menghargai untuk seorang sahabat dalam bahasa Indonesia. Panjangnya sekitar 50-70 kata. Jangan menyertakan salam pembuka atau penutup, hanya isi pesan itu sendiri.";

            // Menyiapkan riwayat chat untuk payload Gemini API
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            // Kunci API ditangani secara otomatis oleh lingkungan Canvas, jadi biarkan kosong
            const apiKey = ""; 

            try {
                // Membuat URL API untuk model Gemini 2.0 Flash
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                // Melakukan panggilan fetch ke Gemini API
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // Memeriksa apakah respons HTTP berhasil
                if (!response.ok) {
                    // Jika respons tidak OK (misal 400, 403, 404, 500), tangani secara spesifik
                    const errorBody = await response.text(); // Ambil teks error dari body respons
                    console.error('API Error Response:', response.status, response.statusText, errorBody);
                    throw new Error(`Gagal menghubungi server. Status: ${response.status} - ${response.statusText}.`);
                }

                // Mengurai respons JSON
                const result = await response.json();
                console.log('Gemini API Response:', result); // Log penuh respons untuk debugging

                // Mengekstrak teks yang dihasilkan dari respons
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    friendshipMessageElement.textContent = text; // Memperbarui tampilan pesan
                } else {
                    // Pesan cadangan jika tidak ada konten yang valid dikembalikan
                    friendshipMessageElement.textContent = 'Maaf, API tidak mengembalikan pesan yang valid. Silakan coba lagi.';
                }
            } catch (error) {
                // Mencatat dan menampilkan kesalahan jika panggilan API gagal
                console.error('Kesalahan saat memanggil Gemini API:', error);
                friendshipMessageElement.textContent = `Terjadi kesalahan: ${error.message}. Coba lagi nanti.`;
            } finally {
                // Menyembunyikan indikator loading dan mengaktifkan kembali tombol
                loadingIndicator.classList.add('hidden');
                generateMessageBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

